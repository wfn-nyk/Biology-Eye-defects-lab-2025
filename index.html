<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WFN Ophthalmic Portal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slide-in-bottom { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: .8; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes flash { 0%, 100% { opacity: 0; } 10%, 90% { opacity: 0; } 50% { opacity: 0.8; } }
        @keyframes curtain-creep { from { transform: translateY(-100%) translateX(50%) rotate(45deg); } to { transform: translateY(-60%) translateX(30%) rotate(30deg); } }
        
        /* Interaction Cues */
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 2px rgba(59, 130, 246, 0.5)); stroke-width: 2px; }
            50% { filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.8)); stroke-width: 3px; }
        }
        @keyframes ring-pulse {
            0% { transform: scale(0.8); opacity: 0.8; stroke-width: 2px; }
            100% { transform: scale(2); opacity: 0; stroke-width: 0px; }
        }
        @keyframes hand-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        .animate-slide-in { animation: slide-in-bottom 0.5s ease-out forwards; }
        .animate-pulse-slow { animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-glow { animation: glow 2.5s ease-in-out infinite; }
        .animate-flash { animation: flash 4s infinite; }
        .animate-curtain { animation: curtain-creep 2s ease-out forwards; }
        .animate-ring-pulse { animation: ring-pulse 2s cubic-bezier(0, 0, 0.2, 1) infinite; }
        .animate-hand-bounce { animation: hand-bounce 1.5s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- ICONS ---
        const Icon = ({ name, size = 24, className, ...props }) => {
            const iconRef = React.useRef(null);
            React.useEffect(() => {
                if (iconRef.current) {
                    lucide.createIcons({
                        icons: { [name]: lucide.icons[name] },
                        nameAttr: 'data-lucide',
                        attrs: { class: `lucide lucide-${name} ${className || ''}`, width: size, height: size, ...props }
                    }, iconRef.current.parentElement);
                }
            }, [name, size, className]);
            return <i data-lucide={name} ref={iconRef} className={className}></i>;
        };

        // SVG Icons
        const LayersIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>;
        const GridIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>;
        const SunIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>;
        const ApertureIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m14.31 8 5.74 9.94"/><path d="M9.69 8h11.48"/><path d="m7.38 12 5.74-9.94"/><path d="M9.69 16 3.95 6.06"/><path d="M14.31 16H2.83"/><path d="m16.62 12-5.74 9.94"/></svg>;
        const ActivityIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const AlertTriangleIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>;
        const InfoIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const ChevronRightIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>;
        const XIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const MousePointerClickIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 9 5 12 1.8-5.2L21 14Z"/><path d="M7.2 2.2 8 5.1"/><path d="m5.1 8-2.9-.8"/><path d="M14 4.1 12 6"/><path d="m6 12-1.9 2"/></svg>;
        const HomeIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const EyeIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>;

        // --- CONFIGURATION: IMAGE MAPPING ---
        // Filenames correspond to what you extracted/uploaded.
        // The component will automatically attempt to load .png then .jpg
        const IMAGE_FILES = {
             "img1": "images/retinal_process", 
             "img2": "images/image2",          
             "img3": "images/image3",          
             "img4": "images/image4",          
             "img5": "images/image5",          
             "img6": "images/image6",          
             "img7": "images/image7",          
             "img8": "images/image8",          
             "img9": "images/image9",          // Intentionally kept for future upload
             "img10": "images/image10",        // Intentionally kept for future upload
             "img11": "images/image11",        // Intentionally kept for future upload
        };

        const SCHOOL_LOGO_URL = "https://raw.githubusercontent.com/wfn-nyk/wfn-qr-code-generator/2458abecf8417d14a51ae89229e8aed72df99de1/School%20Logo_small.png";

        // --- COMPONENTS ---

        // 1. Diagram Placeholder (Revised Size & Format Handling)
        const DiagramPlaceholder = ({ id, label, caption, type = "generic" }) => {
            const baseSrc = IMAGE_FILES[id];
            const [finalSrc, setFinalSrc] = useState(null);
            const [error, setError] = useState(false);

            useEffect(() => {
                if (!baseSrc) return;
                
                const tryImage = (ext) => {
                    const img = new Image();
                    img.src = `${baseSrc}.${ext}`;
                    img.onload = () => setFinalSrc(img.src);
                    img.onerror = () => {
                        if (ext === 'png') tryImage('jpg');
                        else if (ext === 'jpg') tryImage('jpeg');
                        else setError(true);
                    };
                };
                tryImage('png');
            }, [baseSrc]);

            if (finalSrc) {
                return (
                    <div className="my-6 border border-slate-200 bg-white rounded-xl p-4 shadow-sm transition hover:shadow-md">
                        <div className="flex justify-center bg-slate-50 rounded-lg mb-3 overflow-hidden min-h-[200px] items-center">
                             {/* Increased max-height to 600px for better visibility */}
                             <img src={finalSrc} alt={label} className="w-full h-auto max-h-[600px] object-contain" />
                        </div>
                        <div className="text-center border-t border-slate-100 pt-3">
                            <h4 className="font-bold text-slate-700 text-lg">{label}</h4>
                            {caption && <p className="text-sm text-slate-500 mt-1 italic">{caption}</p>}
                        </div>
                    </div>
                );
            }
            
            // Fallback Visuals - Scaled Up
            const renderVisual = () => {
                switch (type) {
                    case 'amd-grid': return (<div className="relative w-full h-64 border border-gray-300 bg-white flex items-center justify-center mx-auto overflow-hidden"><div className="absolute inset-0 grid grid-cols-12 grid-rows-6">{[...Array(72)].map((_, i) => <div key={i} className="border-[0.5px] border-gray-200" />)}</div><div className="absolute inset-0 flex items-center justify-center"><div className="w-24 h-24 bg-black/20 blur-sm rounded-full transform scale-110" /></div></div>);
                    case 'cataract-blur': return (<div className="w-full h-64 bg-gray-100 relative flex items-center justify-center overflow-hidden mx-auto"><EyeIcon className="text-gray-400 blur-sm w-24 h-24" /><div className="absolute inset-0 bg-white/50"></div></div>);
                    case 'retina-detach': return (<div className="w-full h-64 bg-slate-800 relative overflow-hidden flex items-center justify-center mx-auto"><div className="w-full h-1 bg-red-500 transform rotate-12"></div><div className="w-full h-1 bg-red-500 transform -rotate-12"></div></div>);
                    case 'color-blind': return (<div className="w-full h-64 grid grid-cols-2 grid-rows-2 mx-auto"><div className="bg-red-400 opacity-50"></div><div className="bg-green-400 opacity-50"></div><div className="bg-blue-400"></div><div className="bg-yellow-400"></div></div>);
                    default: return (<div className="w-full h-64 bg-slate-100 flex items-center justify-center text-slate-300 mx-auto"><ActivityIcon size={48} /></div>);
                }
            };
            return (
                <div className="my-6 border-2 border-dashed border-slate-300 bg-slate-50 rounded-xl p-4 flex flex-col items-center gap-4 relative group">
                    <div className="absolute top-2 right-2 text-[10px] font-bold bg-slate-200 text-slate-500 px-2 py-1 rounded">PLACEHOLDER</div>
                    <div className="w-full flex-shrink-0 shadow-sm border border-gray-200 rounded-lg overflow-hidden opacity-80 group-hover:opacity-100 transition-opacity">
                        {renderVisual()}
                    </div>
                    <div className="w-full text-center">
                        <h4 className="font-bold text-slate-700 text-lg">{label}</h4>
                        {caption && <p className="text-sm text-slate-500 mt-1 italic">{caption}</p>}
                    </div>
                </div>
            );
        };

        // Component for Pulsing Click Targets
        const TargetIndicator = ({ x, y }) => (
            <g className="pointer-events-none">
                <circle cx={x} cy={y} r="15" fill="none" stroke="#3b82f6" className="animate-ring-pulse" />
                <circle cx={x} cy={y} r="5" fill="#3b82f6" />
                <text x={x} y={y-20} fontSize="20" textAnchor="middle" className="animate-hand-bounce">üëÜ</text>
            </g>
        );

        // 2. Interactive Anatomical Eye Model
        const AnatomicalEye = ({ condition, onPartClick }) => {
            const isHome = condition === 'home';
            const [hoveredPart, setHoveredPart] = useState(null);

            const getPartClass = (partName) => {
                if (!isHome) {
                    // Active Condition View: Highlights for active defects
                    if ((partName === 'lens' && condition === 'cataract') ||
                        (partName === 'retina' && (condition === 'colorblind' || condition === 'retinal')) ||
                        (partName === 'macula' && condition === 'amd')) {
                        return 'cursor-pointer filter drop-shadow-[0_0_5px_rgba(59,130,246,0.8)]';
                    }
                    if (partName === 'lens') return 'opacity-60';
                    return '';
                }
                const isHovered = hoveredPart === partName;
                return `cursor-pointer transition-all duration-300 ${isHovered ? 'filter brightness-110 stroke-2' : 'opacity-90 animate-glow'}`;
            };

            const handleHomeClick = (targetCondition) => {
                if (isHome && onPartClick) onPartClick(targetCondition);
            };

            return (
                <div className="relative w-full h-full mx-auto flex items-center justify-center">
                <svg viewBox="0 0 300 300" className={`w-full h-full drop-shadow-md ${isHome ? 'max-w-md' : 'max-h-[220px]'}`}>
                    <defs>
                        <radialGradient id="eyeballGrad" cx="50%" cy="50%" r="50%">
                            <stop offset="80%" stopColor="#fff" />
                            <stop offset="100%" stopColor="#e2e8f0" />
                        </radialGradient>
                    </defs>

                    <g onMouseEnter={() => isHome && setHoveredPart('nerve')} onMouseLeave={() => isHome && setHoveredPart(null)} onClick={() => handleHomeClick('colorblind')} className={isHome ? "cursor-pointer group" : ""}>
                        <path d="M 260 140 L 300 145 L 300 155 L 260 160 Z" fill="#f87171" className={isHome ? (hoveredPart === 'nerve' ? 'fill-red-500' : 'fill-red-400 animate-glow') : 'fill-red-400'} />
                    </g>

                    <circle cx="150" cy="150" r="110" fill="url(#eyeballGrad)" stroke="#cbd5e1" strokeWidth="2" />

                    <g className={getPartClass('retina')} onMouseEnter={() => isHome && setHoveredPart('retina')} onMouseLeave={() => isHome && setHoveredPart(null)} onClick={() => { if (isHome) handleHomeClick('retinal'); else if (condition === 'colorblind' || condition === 'retinal') onPartClick('retina'); }}>
                        <path d="M 250 150 A 100 100 0 1 0 150 250" fill="none" stroke={isHome && hoveredPart === 'retina' ? "#ef4444" : (condition === 'colorblind' ? "#a855f7" : "#fb923c")} strokeWidth={isHome && hoveredPart === 'retina' ? "8" : "5"} strokeLinecap="round" className={condition === 'retinal' && !isHome ? 'opacity-0' : 'opacity-100 transition-all'} />
                        <path d="M 250 150 A 100 100 0 1 1 150 50" fill="none" stroke={isHome && hoveredPart === 'retina' ? "#ef4444" : (condition === 'colorblind' ? "#a855f7" : "#fb923c")} strokeWidth={isHome && hoveredPart === 'retina' ? "8" : "5"} strokeLinecap="round" className="transition-all" />
                    </g>

                    {condition === 'retinal' && (
                    <path d="M 240 150 C 200 160, 160 180, 140 200" fill="none" stroke="#ef4444" strokeWidth="5" strokeDasharray="4 2" className="animate-pulse cursor-pointer hover:stroke-red-600" onClick={() => onPartClick('detached-retina')} />
                    )}

                    <g onMouseEnter={() => isHome && setHoveredPart('macula')} onMouseLeave={() => isHome && setHoveredPart(null)} onClick={() => { if (isHome) handleHomeClick('amd'); else if (condition === 'amd') onPartClick('macula'); }} className={getPartClass('macula')}>
                    {condition === 'amd' ? (
                        <g className="animate-pulse"><circle cx="255" cy="150" r="8" fill="#ef4444" className="hover:fill-red-600"/><circle cx="252" cy="145" r="3" fill="#fbbf24" /><circle cx="252" cy="155" r="3" fill="#fbbf24" /></g>
                    ) : (
                        <circle cx="255" cy="150" r={isHome && hoveredPart === 'macula' ? "8" : "5"} fill={isHome && hoveredPart === 'macula' ? "#ef4444" : "#fca5a5"} className="transition-all" />
                    )}
                    </g>

                    <ellipse cx="90" cy="150" rx="15" ry="45" fill={condition === 'cataract' ? "#fef3c7" : (isHome && hoveredPart === 'lens' ? "#fde047" : "#bae6fd")} className={`transition-colors duration-300 ${getPartClass('lens')}`} stroke="#60a5fa" strokeWidth="1" onMouseEnter={() => isHome && setHoveredPart('lens')} onMouseLeave={() => isHome && setHoveredPart(null)} onClick={() => { if (isHome) handleHomeClick('cataract'); else if (condition === 'cataract') onPartClick('lens'); }} />
                    
                    <path d="M 60 110 C 20 110, 20 190, 60 190" fill="none" stroke="#94a3b8" strokeWidth="2" className="opacity-30 pointer-events-none" />
                    <path d="M 60 110 C 30 120, 30 180, 60 190" fill="#eff6ff" fillOpacity="0.5" className="pointer-events-none" />

                    {isHome ? (
                        <><TargetIndicator x={270} y={150} /><TargetIndicator x={90} y={150} /><TargetIndicator x={255} y={150} /><TargetIndicator x={200} y={50} /></>
                    ) : (
                        // Indicators for active condition views to prompt clicking for details
                        <>
                            {condition === 'cataract' && <TargetIndicator x={90} y={150} />}
                            {condition === 'retinal' && <TargetIndicator x={175} y={220} />}
                            {condition === 'amd' && <TargetIndicator x={255} y={150} />}
                            {condition === 'colorblind' && <TargetIndicator x={250} y={50} />}
                        </>
                    )}
                </svg>
                </div>
            );
        };

        // 3. Vision Simulator
        const VisionSimulator = ({ condition }) => {
            return (
                <div className="flex flex-col items-center justify-center bg-slate-900 rounded-xl shadow-sm overflow-hidden h-48 md:h-56 w-full">
                <div className="relative w-full max-w-sm aspect-video bg-sky-300 overflow-hidden border-4 border-slate-800 rounded-lg group cursor-default h-full">
                    <div className={`absolute inset-0 w-full h-full transition-all duration-500 bg-gradient-to-b from-sky-300 to-green-200`}>
                        <div className="absolute top-4 right-8 w-12 h-12 bg-yellow-400 rounded-full shadow-lg opacity-90" />
                        <div className="absolute bottom-10 left-0 w-32 h-24 bg-emerald-700 transform rotate-45 translate-y-12 -translate-x-8" />
                        <div className="absolute bottom-10 right-10 w-40 h-32 bg-emerald-600 transform rotate-45 translate-y-16 translate-x-8" />
                        <div className="absolute bottom-4 left-12 w-4 h-20 bg-amber-800" />
                        <div className="absolute bottom-20 left-6 w-16 h-16 bg-green-600 rounded-full opacity-90" />
                        <div className="absolute bottom-28 left-12 w-12 h-12 bg-green-500 rounded-full opacity-90" />
                        <div className="absolute bottom-0 left-1/2 w-24 h-full bg-amber-100 transform -translate-x-1/2 perspective-100 skew-x-12 opacity-60" />
                        <div className="absolute bottom-8 left-1/2 w-4 h-8 bg-blue-500 rounded-t-lg transform -translate-x-2" />
                    </div>

                    {condition === 'cataract' && (
                    <div className="absolute inset-0 backdrop-blur-[4px] bg-yellow-50/30 flex items-center justify-center"><div className="absolute inset-0 bg-white/40" /></div>
                    )}

                    {condition === 'retinal' && (
                    <>
                        <div className="absolute -top-10 -right-10 w-[150%] h-[150%] bg-black rounded-[100%] opacity-90 animate-curtain pointer-events-none" style={{ transformOrigin: 'top right' }} />
                        <div className="absolute top-10 left-10 w-3 h-3 bg-white blur-sm rounded-full animate-flash" style={{ animationDelay: '0s' }} />
                        <div className="absolute top-1/2 right-1/3 w-2 h-2 bg-white blur-md rounded-full animate-flash" style={{ animationDelay: '2.3s' }} />
                        <div className="absolute top-1/4 right-1/4 w-1 h-1 bg-black rounded-full opacity-60 animate-float" />
                        <div className="absolute bottom-1/3 left-1/3 w-1.5 h-1.5 bg-black rounded-full opacity-50 animate-float" style={{ animationDelay: '1s' }} />
                    </>
                    )}

                    {condition === 'amd' && (
                    <div className="absolute inset-0 flex items-center justify-center">
                        <svg className="absolute inset-0 w-full h-full opacity-50 pointer-events-none"><filter id="wavy"><feTurbulence type="turbulence" baseFrequency="0.01" numOctaves="2" result="turbulence" /><feDisplacementMap in2="turbulence" in="SourceGraphic" scale="20" xChannelSelector="R" yChannelSelector="G" /></filter><rect width="100%" height="100%" fill="transparent" filter="url(#wavy)" /></svg>
                        <div className="w-24 h-24 bg-black rounded-full blur-xl opacity-80" />
                    </div>
                    )}

                    {condition === 'colorblind' && (
                    <div className="absolute inset-0 bg-slate-500 mix-blend-color saturation-0" />
                    )}

                    <div className="absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm">Patient View</div>
                </div>
                </div>
            );
        };

        // 4. Detail Popup (Backdrop Click Enabled)
        const DetailPopup = ({ title, content, onClose }) => (
            <div 
                className="absolute inset-0 z-20 flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm animate-fade-in"
                onClick={onClose} // Close when clicking the background
            >
                <div 
                    className="bg-white rounded-lg shadow-xl max-w-xs w-full overflow-hidden border border-blue-100"
                    onClick={(e) => e.stopPropagation()} // Prevent close when clicking inside the box
                >
                    <div className="bg-blue-600 px-4 py-3 flex items-center justify-between">
                        <h4 className="text-white font-bold text-sm flex items-center gap-2"><InfoIcon size={16} /> {title}</h4>
                        <button onClick={onClose} className="text-blue-100 hover:text-white"><XIcon size={16} /></button>
                    </div>
                    <div className="p-4">
                        <div className="text-sm text-slate-600 leading-relaxed">{content}</div>
                        <div className="mt-4 text-right"><button onClick={onClose} className="text-xs font-bold text-blue-600 hover:underline">Close</button></div>
                    </div>
                </div>
            </div>
        );

        const POPUP_CONTENT = {
            'cataract-lens': { title: 'The Crystalline Lens', content: <> <p className="mb-2">Normally clear and flexible.</p><p>In <strong>Cataracts</strong>, proteins clump creating cloudiness.</p> </> },
            'retinal-detached-retina': { title: 'Retinal Detachment', content: <> <p className="mb-2">Retina peels away from blood vessels.</p><p><strong>Critical:</strong> Cells die without nutrients.</p> </> },
            'amd-macula': { title: 'The Macula', content: <> <p className="mb-2">Responsible for central vision.</p><p>In <strong>AMD</strong>, drusen or bleeding damages this area.</p> </> },
            'colorblind-retina': { title: 'Rod & Cone Cells', content: <> <p className="mb-2">Cones detect color.</p><p><strong>Color Blindness</strong>: Missing or faulty cones.</p> </> }
        };

        const SimulationPanel = ({ condition }) => {
            const [activePopup, setActivePopup] = useState(null);

            return (
                <div className="grid md:grid-cols-2 gap-4 mb-6 bg-slate-50 p-3 rounded-xl border border-slate-200 relative">
                <div className="relative h-full flex flex-col justify-between">
                    <h4 className="text-xs font-bold text-slate-500 mb-2 text-center flex items-center justify-center gap-2 uppercase tracking-wide">
                    Anatomy Model
                    </h4>
                    <div className="bg-white rounded-xl border border-slate-100 shadow-sm py-2 flex-1 flex items-center justify-center relative overflow-hidden min-h-[220px]">
                        <AnatomicalEye condition={condition} onPartClick={(part) => {
                            const key = `${condition}-${part}`;
                            if (POPUP_CONTENT[key]) setActivePopup(key);
                        }} />
                        {activePopup && <DetailPopup title={POPUP_CONTENT[activePopup].title} content={POPUP_CONTENT[activePopup].content} onClose={() => setActivePopup(null)} />}
                    </div>
                </div>
                <div className="h-full flex flex-col justify-between">
                    <h4 className="text-xs font-bold text-slate-500 mb-2 text-center uppercase tracking-wide">Patient View Simulation</h4>
                    <VisionSimulator condition={condition} />
                </div>
                </div>
            );
        };

        // --- HOMEPAGE COMPONENT ---
        const HomePage = ({ onNavigate }) => {
            return (
                <div className="animate-fade-in text-center max-w-4xl mx-auto py-8">
                    <h2 className="text-3xl font-bold text-slate-800 mb-2">Welcome to the eye defect AR laboratory</h2>
                    <p className="text-slate-600 mb-8">Explore the human eye. Click on the <strong>target circles</strong> to learn about their associated conditions.</p>
                    
                    <div className="bg-white p-8 rounded-2xl shadow-lg border border-slate-200 relative overflow-hidden group">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <div className="w-full h-64 md:h-80 flex items-center justify-center mb-8 mt-4">
                            <AnatomicalEye condition="home" onPartClick={onNavigate} />
                        </div>
                        
                        <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-full px-4">
                            <div className="bg-blue-100 border border-blue-300 text-blue-800 px-4 py-2 rounded-full font-bold shadow-sm flex items-center justify-center gap-2 animate-pulse-slow mx-auto max-w-fit">
                                <MousePointerClickIcon size={18} />
                                Click the Targets to Enter
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---

        const EyeDefectApp = () => {
            const [view, setView] = useState('home');
            const [activeTab, setActiveTab] = useState('retinal');

            const navigateToCondition = (conditionId) => {
                setActiveTab(conditionId);
                setView('content');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const tabs = [
                { id: 'retinal', label: 'Retinal', icon: LayersIcon },
                { id: 'amd', label: 'AMD', icon: GridIcon },
                { id: 'cataract', label: 'Cataract', icon: SunIcon },
                { id: 'colorblind', label: 'Color', icon: ApertureIcon },
            ];

            const SectionTitle = ({ children, icon: Icon }) => (
                <h2 className="text-2xl md:text-3xl font-bold text-slate-800 mb-6 flex items-center gap-3 border-b pb-2 border-slate-200">
                {Icon && <Icon className="text-blue-600" size={32} />}
                {children}
                </h2>
            );

            const renderContent = () => {
                switch (activeTab) {
                case 'retinal': return (<div className="animate-slide-in"><SectionTitle icon={LayersIcon}>Retinal Detachment <span className="text-lg font-normal text-gray-500 ml-2">Ë¶ñÁ∂≤ËÜúÂâùÈõ¢</span></SectionTitle><SimulationPanel condition="retinal" /><div className="grid md:grid-cols-2 gap-8"><div className="space-y-4"><div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-full"><h3 className="font-semibold text-lg text-slate-800 mb-4">Pathology Mechanism</h3><DiagramPlaceholder id="img1" label="[Image 1] Retinal Detachment Process" caption="Separation of tissues." type="retina-detach" /><ul className="space-y-3 mt-4"><li className="flex gap-2"><span className="w-2 h-2 mt-2 rounded-full bg-blue-500"></span>Detachment of light-sensitive tissues from eyeball</li><li className="flex gap-2"><span className="w-2 h-2 mt-2 rounded-full bg-blue-500"></span>Insufficient blood supply to cells</li><li className="flex gap-2"><span className="w-2 h-2 mt-2 rounded-full bg-blue-500"></span>Cell death if without prompt surgery</li></ul></div></div><div className="space-y-4"><h3 className="font-semibold text-lg text-slate-800">Visual Symptoms</h3><DiagramPlaceholder id="img2" label="[Image 2] Symptoms" caption="Flashes and dark shadows." type="retina-detach" /><div className="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg shadow-sm my-4"><h3 className="font-bold text-red-800 mb-2 flex items-center gap-2"><AlertTriangleIcon size={18} />Warning Signs</h3><ul className="list-disc list-inside space-y-2 font-medium text-red-900/80"><li>Sudden flashes of light (Photopsia)</li><li>Dark shadow or 'curtain' over vision</li></ul></div></div></div></div>);
                case 'amd': return (<div className="animate-slide-in"><SectionTitle icon={GridIcon}>Age-related Macular Degeneration <span className="text-lg font-normal text-gray-500 ml-2">ËÄÅÂπ¥ÈªÉÊñëÁóÖËÆä</span></SectionTitle><SimulationPanel condition="amd" /><div className="grid md:grid-cols-2 gap-8 mb-8"><div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100"><h4 className="text-center font-semibold text-green-700 mb-2">Healthy Eye</h4><DiagramPlaceholder id="img3" label="[Image 3] Normal Fundus" type="generic" /></div><div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100"><h4 className="text-center font-semibold text-red-700 mb-2">AMD Eye</h4><DiagramPlaceholder id="img4" label="[Image 4] AMD Fundus" type="generic" /></div></div><div className="bg-slate-50 p-6 rounded-xl border border-slate-200"><h3 className="font-bold text-xl text-slate-800 mb-4">Visual Symptoms</h3><div className="flex flex-col md:flex-row gap-6 items-center"><div className="flex-1 w-full"><DiagramPlaceholder id="img5" label="[Image 5] Amsler Grid" caption="Wavy lines." type="amd-grid" /></div><div className="flex-1 space-y-3"><div className="flex items-center gap-3 p-3 bg-white rounded shadow-sm"><div className="bg-slate-100 p-2 rounded-full"><EyeIcon className="text-slate-600" size={20}/></div><span className="font-medium text-slate-700">Central vision loss</span></div><div className="flex items-center gap-3 p-3 bg-white rounded shadow-sm"><div className="bg-slate-100 p-2 rounded-full"><ActivityIcon className="text-slate-600" size={20}/></div><span className="font-medium text-slate-700">Straight lines become blurry/wavy</span></div></div></div></div></div>);
                case 'cataract': return (<div className="animate-slide-in"><SectionTitle icon={SunIcon}>Cataract <span className="text-lg font-normal text-gray-500 ml-2">ÁôΩÂÖßÈöú</span></SectionTitle><SimulationPanel condition="cataract" /><div className="bg-blue-600 text-white p-6 rounded-xl shadow-lg mb-8 flex items-center justify-between"><div><h3 className="text-xl font-bold mb-1">Key Fact</h3><p className="opacity-90">The Commonest cause of blindness in the world.</p></div><InfoIcon className="text-white/50 w-12 h-12" /></div><div className="grid md:grid-cols-3 gap-6 mb-8"><DiagramPlaceholder id="img6" label="[Image 6] The Eye" caption="Anatomy." /><DiagramPlaceholder id="img7" label="[Image 7] Clouding" caption="Clear vs Opaque." /><div className="md:col-span-1 bg-slate-100 p-4 rounded-lg flex flex-col justify-center"><h4 className="font-bold text-slate-700 mb-2">Pathology</h4><p className="text-sm text-slate-600 mb-2">Crystalline lens &rarr; opaque</p><p className="text-sm text-slate-600">&rarr; Light blocked</p></div></div><div className="space-y-4"><h3 className="font-bold text-xl text-slate-800">Symptoms Checklist</h3><div className="flex flex-col md:flex-row gap-6"><div className="flex-1"><DiagramPlaceholder id="img8" label="[Image 8] Vision" caption="Blurry, dim." type="cataract-blur" /></div><div className="flex-1 grid gap-3">{['Blurry vision', 'Dimmer colour sensation', 'Glare hypersensitivity'].map((s, i) => <div key={i} className="flex items-center gap-3 p-4 bg-white border border-slate-200 rounded-lg shadow-sm"><div className="w-2 h-2 bg-orange-400 rounded-full" /><span className="font-medium text-slate-700">{s}</span></div>)}</div></div></div></div>);
                case 'colorblind': return (<div className="animate-slide-in"><SectionTitle icon={ApertureIcon}>Color Blindness <span className="text-lg font-normal text-gray-500 ml-2">Ëâ≤Áõ≤</span></SectionTitle><SimulationPanel condition="colorblind" /><div className="grid lg:grid-cols-2 gap-8 mb-8"><div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100"><h3 className="font-bold text-lg text-slate-800 mb-4 border-b pb-2">Types</h3><div className="space-y-4"><div><span className="font-bold text-red-600">Red-Green</span>: Red/Green cones absent.</div><div><span className="font-bold text-blue-600">Blue-Yellow</span>: Blue cones absent.</div><div><span className="font-bold text-slate-800">Monochromacy</span>: No functional cones (Grey vision).</div></div></div><div className="space-y-4"><h3 className="font-bold text-lg text-slate-800">Visual References</h3><DiagramPlaceholder id="img9" label="[Image 9] Spectrum" type="color-blind" /><DiagramPlaceholder id="img10" label="[Image 10] Ishihara Test" /><DiagramPlaceholder id="img11" label="[Image 11] Visual Pathway" /><div className="bg-slate-800 text-slate-200 p-4 rounded-xl mt-4"><h3 className="font-bold text-white mb-2 flex items-center gap-2"><ActivityIcon size={20} /> Causes</h3><div className="text-sm">Genetic, Eye injury, Visual pathway/Optic nerve injury</div></div></div></div></div>);
                default: return <div>Select a tab</div>;
                }
            };

            // Navigation Header Logic
            const NavButtons = () => (
                <div className="flex items-center gap-2 overflow-x-auto py-2 md:py-0 w-full md:w-auto">
                    <button 
                        onClick={() => setView('home')}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg font-bold transition-colors whitespace-nowrap ${view === 'home' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'}`}
                    >
                        <HomeIcon size={18} /> Home
                    </button>
                    {tabs.map(tab => (
                        <button
                            key={tab.id}
                            onClick={() => { setActiveTab(tab.id); setView('content'); }}
                            className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${view === 'content' && activeTab === tab.id ? 'bg-blue-600 text-white' : 'bg-white text-slate-600 hover:bg-slate-100 border border-slate-200'}`}
                        >
                            <tab.icon size={16} /> {tab.label}
                        </button>
                    ))}
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
                <header className="bg-white shadow-sm sticky top-0 z-50">
                    <div className="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row items-center justify-between gap-4">
                        <div 
                            className="flex items-center gap-3 cursor-pointer flex-shrink-0 self-start md:self-auto" 
                            onClick={() => setView('home')}
                        >
                            <img 
                                src={SCHOOL_LOGO_URL} 
                                alt="School Logo" 
                                className="w-10 h-10 object-contain"
                                onError={(e) => { e.target.src='https://placehold.co/48x48/3b82f6/ffffff?text=WFN'; }}
                            />
                            <div>
                                <h1 className="text-lg font-bold text-slate-800 leading-none">WFN Ophthalmic Portal</h1>
                                <p className="text-[10px] text-slate-500 mt-0.5">by WFNC Biology department</p>
                            </div>
                        </div>
                        <NavButtons />
                    </div>
                </header>

                <main className="max-w-5xl mx-auto px-4 py-8">
                    {view === 'home' ? (
                        <HomePage onNavigate={navigateToCondition} />
                    ) : (
                        <div className="w-full">
                            {renderContent()}
                        </div>
                    )}
                </main>

                <footer className="border-t border-slate-200 bg-white mt-12 py-8">
                    <div className="max-w-5xl mx-auto px-4 text-center text-slate-400 text-sm">
                    <p>¬© WFNC Biology department 2025 : Eye Defect awareness project</p>
                    </div>
                </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EyeDefectApp />);
    </script>
</body>
</html>
